"use strict";(()=>{var e={};e.id=278,e.ids=[278],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8557:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>b,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>l,staticGenerationAsyncStorage:()=>p});var a={};t.r(a),t.d(a,{POST:()=>u});var o=t(9303),n=t(8716),s=t(670),i=t(7070);async function u(e){let r=function(e){let r=e.headers.get("x-bbox-fid");if(!r)return null;let t=Number(r);return Number.isFinite(t)?t:null}(e);if(!r)return i.NextResponse.json({error:"Missing FID (x-bbox-fid header)"},{status:401});let{txHash:t,packSize:a}=await e.json();if(!t||!a)return i.NextResponse.json({error:"Missing txHash or packSize"},{status:400});await Object(function(){var e=Error("Cannot find module '@/lib/user'");throw e.code="MODULE_NOT_FOUND",e}())(r);let{data:o,error:n}=await Object(function(){var e=Error("Cannot find module '@/lib/supabaseServer'");throw e.code="MODULE_NOT_FOUND",e}()).from("user_stats").select("*").eq("fid",r).single();if(n||!o)return console.error("extra buy stats error",n),i.NextResponse.json({error:"Stats not found"},{status:500});let s=o.extra_picks_balance+Number(a),{data:u,error:c}=await Object(function(){var e=Error("Cannot find module '@/lib/supabaseServer'");throw e.code="MODULE_NOT_FOUND",e}()).from("user_stats").update({extra_picks_balance:s}).eq("fid",r).select("*").single();if(c)return console.error("extra buy update error",c),i.NextResponse.json({error:"Failed to update picks balance"},{status:500});let{error:d}=await Object(function(){var e=Error("Cannot find module '@/lib/supabaseServer'");throw e.code="MODULE_NOT_FOUND",e}()).from("payments").insert({fid:r,type:"extra",pack_size:a,eth_amount:null,tx_hash:t,status:"confirmed"});return d&&console.error("extra buy payment insert error",d),i.NextResponse.json({success:!0,extraPicksBalance:u.extra_picks_balance})}(function(){var e=Error("Cannot find module '@/lib/supabaseServer'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/user'");throw e.code="MODULE_NOT_FOUND",e}();let c=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/buy/extra/route",pathname:"/api/buy/extra",filename:"route",bundlePath:"app/api/buy/extra/route"},resolvedPagePath:"/workspaces/bbox/src/app/api/buy/extra/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:l}=c,b="/api/buy/extra/route";function x(){return(0,s.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:p})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,972],()=>t(8557));module.exports=a})();